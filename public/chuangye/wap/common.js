var scroll=(function(){var cacheTop=undefined;var allow=function(){document.documentElement.style.overflowY="auto";document.body.style.overflowY="auto";window.scrollTo(0,cacheTop);};var ban=function(){cacheTop=scroll.top();document.documentElement.style.overflowY="hidden";document.body.style.overflowY="hidden";document.body.style.top=(-1*cacheTop)+"px";};var top=function(){return document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;}
return{allow:allow,ban:ban,top:top}})();var filter={open:function(){document.getElementById("filterMask").classList.add("show");scroll.ban();},close:function(dom){var mask=document.getElementById("filterMask");if(event.target===dom){mask.classList.remove("show");scroll.allow();}},search:function(){var dom=event.target.closest(".search-line");var value=dom.children[1].value;var url=dom.children[2].dataset.url;window.location.href=url+value;},listenEnter:function(){if(event.keyCode===13){this.search();}},getWare:function(id){var target=event.target;var parent=target.parentElement;var loadname=target.dataset.loadname;var name=target.textContent;var template=parent.dataset.template;var templateall=parent.dataset.templateall;var title=parent.dataset.title;http.get("/ajax/ware.ashx?id="+id,undefined,function(text){var data=JSON.parse(text);var linkTemplate='<a  title="{title}" href="{href}">{text}</a>';var allTitle=title.replace('{0}',(!title.startsWith('{0}')&&name==='全部')?'':name);var html=linkTemplate.replace('{title}',allTitle).replace('{href}',(loadname?template.replace('{0}',loadname):templateall)).replace('{text}','全部');for(var item in data){html+=linkTemplate.replace('{title}',title.replace('{0}',data[item].Name)).replace('{href}',template.replace('{0}',data[item].LoadName)).replace('{text}',data[item].Name);}
document.querySelector(".filter-box").innerHTML=html;});}}
var liuyan={submiting:false,open:function(userid){var mask=document.getElementById("liuyanMask");var form=mask.querySelector(".liuyan");if(!form){var liuyanBox=document.querySelector(".liuyan");form=liuyanBox.cloneNode(true);form.classList.remove("hidden");mask.appendChild(form);form.querySelector(".close").classList.remove("hidden");}
if(userid){form.dataset.userid=userid;}
mask.style.display="block";scroll.ban();setTimeout(function(){mask.classList.add("show");},0);},close:function(){var mask=document.getElementById("liuyanMask");if(event.target===mask||event.target.classList.contains("close")){mask.classList.remove("show");scroll.allow();setTimeout(function(){mask.style.display="none";},300);}},submit:function(){if(liuyan.submiting){return;}
liuyan.submiting=true;var form=event.target.closest(".liuyan");var formData={UserID:form.dataset.userid,Name:form.username.value.trim(),Phone:form.phone.value.trim(),Content:form.message.value.trim(),Sex:form.sex.value};var checkResult=liuyan.checkForm(formData);if(checkResult){alert(checkResult);liuyan.submiting=false;return;}
if(!formData.Content){formData.Content="对此项目很感兴趣，想加盟，请速与我联系";}
http.post("/ajax/saveLiuyan.ashx",formData,function(text){form.appendChild(dialog.get("留言发送提示",text,true));liuyan.submiting=false;});},checkForm:function(formData){if(!formData.Name){return "姓名不能为空";}
if(!formData.Phone){return "手机号码不能为空";}else{if(!util.checkPhone(formData.Phone)){return "手机号码格式不正确"}}}}
var freetalk={submitting:false,open:function(){var mask=document.getElementById("freetalkMask");mask.style.display="block";scroll.ban();setTimeout(function(){mask.classList.add("show");},0);},close:function(){var mask=document.getElementById("freetalkMask");if(event.target===mask||event.target.classList.contains("close")){mask.classList.remove("show");scroll.allow();setTimeout(function(){mask.style.display="none";},300);}},submit:function(){if(freetalk.submiting){return;}
freetalk.submiting=true;var form=document.getElementById("freetalkMask").querySelector(".freetalk");var formData={UserID:form.dataset.userid,Phone:form.phone.value.trim(),Content:"对此项目很感兴趣，想加盟，请速与我联系"}
var checkResult=freetalk.checkForm(formData);if(checkResult){alert(checkResult);freetalk.submiting=false;return;}
http.post("/ajax/saveLiuyan.ashx",formData,function(text){alert("我们将稍后和您联系，请保持电话畅通！");freetalk.submiting=false;});},checkForm:function(formData){if(!formData.Phone){return "手机号码不能为空！";}
if(!util.checkPhone(formData.Phone)){return "手机号码格式不正确！";}}}
util={checkPhone:function(phoneNum){var reg=/^1[3|4|5|6|7|8|9][0-9]\d{8}$/;return reg.exec(phoneNum)}}
var dialog={get:function(headInfo,contentInfo,isShowWx){var domDialog=document.createElement("div");domDialog.className="dialog";var domHead=document.createElement("div");domHead.className="dialog-head";domHead.innerText=headInfo;domHead.addEventListener("click",dialog.close);var domContent=document.createElement("div");domContent.className="dialog-content";var domInfo=document.createElement("p");domInfo.innerText=contentInfo;domDialog.appendChild(domHead);domDialog.appendChild(domContent);domContent.appendChild(domInfo);if(isShowWx){var domWx=document.createElement("p");domWx.innerText="请加微信公众号：xiangmu114";domContent.appendChild(domWx);}
return domDialog;},close:function(){event.target.closest(".dialog").remove();}}
var swiperHelper={swiper:null,init:function(){if(document.querySelector(".swiper-container")){swiperHelper.swiper=new Swiper('.swiper-container',{prevButton:'.prev',nextButton:'.next',loop:true,paginationType:'fraction',pagination:'.carousel-foot',autoplay:3000,autoplayDisableOnInteraction:false,lazyLoading:true,lazyLoadingInPrevNext:true});}}}
var tab={init:function(){var tabs=document.querySelectorAll(".tab");if(tabs.length>0){for(var i=0;i<tabs.length;i++){var tab=tabs[i];(function(tab){tab.addEventListener("click",function(){var targetIndex=0;var target=event.target;var btns=tab.querySelectorAll("button");for(var index=0;index<btns.length;index++){if(btns[index]==target){target.classList.add("selected");targetIndex=index;}else{btns[index].classList.remove("selected");}}
var contentBoxs=tab.nextElementSibling.children;for(var index=0;index<contentBoxs.length;index++){if(index==targetIndex){contentBoxs[index].classList.remove("hidden");}else{contentBoxs[index].classList.add("hidden");}}});})(tab);}}}}
var content={init:function(){var moreLine=document.querySelector(".more-line");var contentBox=document.querySelector(".content-box");if(contentBox&&moreLine&&!moreLine.classList.contains("hidden")){var height=Number(window.getComputedStyle(contentBox).height.match(/([\d|.]+)px/)[1]);if(height<550){moreLine.classList.add("hidden");}else{contentBox.classList.add("short");}}},showAll:function(){event.target.parentElement.querySelector(".content-box").classList.remove("short");event.target.classList.add("hidden");}}
var img=(function(){mask=undefined;state=undefined;imgDom=undefined;pop=function(){if(swiperHelper.swiper){swiperHelper.swiper.stopAutoplay();}
showImg(event.target.src);};close=function(){mask.classList.remove("show");imgDom.style.width=state.width+"px";imgDom.style.left=state.left+"px";imgDom.style.top=state.top+"px";imgDom.style.position="absolute";setTimeout(function(){mask.style.display="none";mask.removeChild(imgDom);},300);if(swiperHelper.swiper){swiperHelper.swiper.startAutoplay();}};getMask=function(){if(!mask){mask=document.createElement("div");mask.className="full-screen-imgcontainer animate";mask.addEventListener("click",close);document.body.appendChild(mask);}
return mask;};showImg=function(src){imgDom=document.createElement("img");imgDom.src=src;getMask().appendChild(imgDom);state=getState();setSourceState();mask.style.display="block";setTimeout(function(){mask.classList.add("show");imgDom.style.width="100%";imgDom.style.left="0px";imgDom.style.top=state.transY+"px";},0);};setSourceState=function(){imgDom.style.width=state.width+"px";imgDom.style.left=state.left+"px";imgDom.style.top=state.top+"px";imgDom.style.position="absolute";};getState=function(){return{left:event.pageX-event.offsetX,top:event.pageY-event.offsetY,width:event.target.width,height:event.target.height,transY:(window.innerHeight-((event.target.height*window.innerWidth)/event.target.width))/2}}
return{pop:pop}})()
var http={post:function(url,data,callback){var postData={method:"POST",body:http.ToFormData(data)};fetch(url,postData).then(function(response){return response.text();}).then(function(text){if(typeof(callback)=="function"){callback(text);}});},get:function(url,data,callback){fetch(url+http.ToQueryData(data)).then(function(response){return response.text();}).then(function(text){if(typeof(callback)=="function"){callback(text);}});},ToFormData:function(data){if(Object.prototype.toString.call(data)==="[object FormData]"){return data;}
var formData=new FormData();for(var item in data){formData.append(item,data[item]);}
return formData;},ToQueryData:function(data){if(data){var list=[];for(var item in data){list.push(item+"="+data[item]);}
return "?"+list.join("&");}else{return "";}}}
var init=(function(){swiperHelper.init();tab.init();content.init();})();